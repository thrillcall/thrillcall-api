
<style type="text/css">
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #dddddd; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<h1>Thrillcall API</h1>

<p>This document describes the Thrillcall API v3, and usage for the provided Ruby API wrapper gem.</p>

<h1>Ruby API Wrapper</h1>

<h3>Usage:</h3>

<div class="highlight">
<pre>    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># First, require the gem:</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="nb">require</span> <span class="s1">'rubygems'</span>
    <span class="nb">require</span> <span class="s1">'thrillcall-api'</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Instantiate with your Thrillcall API key:</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="no">MY_API_KEY</span> <span class="o">=</span> <span class="s2">"1234567890abcdef"</span>
    <span class="n">tc</span> <span class="o">=</span> <span class="no">ThrillcallAPI</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">MY_API_KEY</span><span class="p">)</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Access any endpoint directly from the instance</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># This is like calling GET "/events"</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">events</span>
    <span class="c1"># =&gt; [ {"id" =&gt; ... }, {...}, ...]</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Provide IDs as arguments</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># GET "/event/1"</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># =&gt; {"id" =&gt; 1, ...}</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Provide parameters as arguments</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># GET "/events?limit=5"</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1"># =&gt; [ {"id" =&gt; ... }, {...}, ...]</span>
    <span class="n">events</span><span class="o">.</span><span class="n">length</span>
    <span class="c1"># =&gt; 5</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Chain methods together for nested routes</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># GET "/search/venues/warfield?postalcode=94101&amp;radius=20"</span>
    <span class="n">venues</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">venues</span><span class="p">(</span><span class="s2">"warfield"</span><span class="p">,</span> <span class="ss">:postalcode</span> <span class="o">=&gt;</span> <span class="s2">"94101"</span><span class="p">,</span> <span class="ss">:radius</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">)</span>
    <span class="c1"># =&gt; [{"name" =&gt; "The Warfield", ...}]</span>

    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># POST and PUT are explicit methods</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">artist</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Bleeding Chest Wounds"</span><span class="p">)</span>
    <span class="c1"># =&gt; {"id" =&gt; 3, "name" =&gt; "Bleeding Chest Wounds", ...}</span>

    <span class="n">artist</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">artist</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Grizzle and The Plenty"</span><span class="p">)</span>
    <span class="c1"># =&gt; {"id" =&gt; 3, "name" =&gt; "Grizzle and The Plenty", ...}</span>
</pre>
</div>


<h3>Advanced Usage:</h3>

<p>Provide additional instantiation options:</p>

<div class="highlight">
<pre>    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># The default SSL endpoint is "https://api.thrillcall.com/api/".</span>
    <span class="c1"># The default API version is 3.</span>
    <span class="c1"># By default, Faraday access logging is turned off.</span>
    <span class="c1"># If a connection attempt fails, we will retry 5 times with a</span>
    <span class="c1"># timeout of 10 seconds.  We retry a boilerplate list of</span>
    <span class="c1"># exceptions, such as Faraday::Error::ClientError.</span>
    <span class="c1"># Override these if necessary:</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="n">tc</span> <span class="o">=</span> <span class="no">ThrillcallAPI</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
      <span class="no">MY_API_KEY</span><span class="p">,</span>
      <span class="ss">:base_url</span>         <span class="o">=&gt;</span> <span class="s2">"https://api.thrillcall.com/custom/"</span><span class="p">,</span>
      <span class="ss">:version</span>          <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
      <span class="ss">:logger</span>           <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
      <span class="ss">:retry_exceptions</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="no">Timeout</span><span class="o">::</span><span class="no">Error</span><span class="o">]</span><span class="p">,</span>
      <span class="ss">:retry_tries</span>      <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
      <span class="ss">:timeout</span>          <span class="o">=&gt;</span> <span class="mi">10</span>
    <span class="p">)</span>
</pre>
</div>


<p>Internally, the wrapper returns a ThrillcallAPI::Result class for any call.  Data for the request is fetched only when used.  This allows you to build requests piecemeal before executing them.</p>

<div class="highlight">
<pre>    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="c1"># Build a partial request, add on to it later</span>
    <span class="c1">#---------------------------------------------------------------#</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">artist</span><span class="p">(</span><span class="mi">22210</span><span class="p">)</span> <span class="c1"># Lady Gaga</span>

    <span class="c1"># GET "/artist/22210/events?limit=2"</span>
    <span class="n">artist_events</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">artist_events</span><span class="o">.</span><span class="n">length</span>
    <span class="c1"># =&gt; 2</span>
</pre>
</div>


<p>This gem is a convenience wrapper around the excellent Faraday project.  If more complicated use cases are necessary, consider using Faraday directly.</p>

<div class="highlight">
<pre>    <span class="nb">require</span> <span class="s1">'faraday'</span>
    <span class="nb">require</span> <span class="s1">'json'</span>

    <span class="no">MY_API_KEY</span>  <span class="o">=</span> <span class="s2">"1234567890abcdef"</span>
    <span class="no">BASE_URL</span>    <span class="o">=</span> <span class="s2">"https://api.thrillcall.com/api/v3/"</span>
    <span class="no">HEADERS</span>     <span class="o">=</span> <span class="p">{</span> <span class="ss">:accept</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span> <span class="p">}</span>

    <span class="n">connection</span>  <span class="o">=</span> <span class="no">Faraday</span><span class="o">.</span><span class="n">new</span><span class="p">(</span> <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="no">BASE_URL</span><span class="p">,</span> <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="no">HEADERS</span> <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
      <span class="n">builder</span><span class="o">.</span><span class="n">adapter</span> <span class="no">Faraday</span><span class="o">.</span><span class="n">default_adapter</span>
      <span class="n">builder</span><span class="o">.</span><span class="n">response</span> <span class="ss">:logger</span>
      <span class="n">builder</span><span class="o">.</span><span class="n">response</span> <span class="ss">:raise_error</span>
    <span class="k">end</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">get</span> <span class="k">do</span> <span class="o">|</span><span class="n">req</span><span class="o">|</span>
      <span class="n">req</span><span class="o">.</span><span class="n">url</span> <span class="s2">"artist/22210"</span><span class="p">,</span> <span class="p">{</span> <span class="ss">:api_key</span> <span class="o">=&gt;</span> <span class="no">MY_API_KEY</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="n">artist</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="n">artist</span><span class="o">[</span><span class="s2">"name"</span><span class="o">]</span>
    <span class="c1"># =&gt; "Lady Gaga"</span>
</pre>
</div>

